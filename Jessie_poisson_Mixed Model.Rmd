---
title: "Fisheries_class"
author: "Jessie Lilly"
date: "March 20, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Load tidyverse

```{r}
library(tidyverse)
```

## Create a data frame that just lists 

```{r}
data.frame(table(aw.df$h))
aw.df.2 <- aw.df %>% group_by(h) %>%tally()
```


## Create a density plot comparing abundance of Alewife by the hour of the day. 

```{r}
ggplot(aw.df,aes(h))+
  geom_density()+
 xlab("Hour of day")+
ggtitle("Amount of Alewife Captured Per Hour at Ahmerst and Missassguash Tidal Gates")


```
## Create a density plot comparing the two fishways *Ahmerst= cbcl, and Missaguash= mstdg) 

```{r}
target <- c("cbcl","mstgd")
temp_st <- filter(aw.df, site %in% target) 


```


```{r}
ggplot(temp_st,aes(h))+
  geom_density(mapping=aes(color=site))+
 xlab("Hour of day")+
ggtitle("Amount of Alewife Captured Per Hour:Ahmerst and Missassguash Tidal Gates")
```


## Install Gam package

```{r}
install.packages("gam")
install.packages("mgcv")
```


## Fit my data using a gam function instead of glm. 
## There no longer appears to be a significant difference between hour and abundance of Alewife caught. 


```{r}
library(mgcv)
pg1 <- gam(n ~ h,family = poisson, data = aw.df.2)

summary(pg1)
```

## Plot the model

```{r}
library(tidyverse)
plot(pg1)
```

## Read in Tide Data 
## Change date and create an hour column. 

```{r}
library(readr)
tidal_cycles <- read_csv("tidal_cycles.csv", 
    col_types = cols(enter = col_date(format = "%m/%d/%Y")))
View(tidal_cycles)



```




## Seperate year month and day year into seperate columns in Tidal_cycles. 
## Create a column with just month and day. 

```{r}
tidal_cycles<- cbind(tidal_cycles, day=day(tidal_cycles$enter), month=month(tidal_cycles$enter), year=year(tidal_cycles$enter))



```

## Create a column that just includes month and day in tidal_cycles2

```{r}

tidal_cycles2 <- tidal_cycles %>%
  mutate(enter=make_date(!year,month,day))

tidal_cycles3 <- tidal_cycles %>%
  mutate(enter=make_date(!year,month,day,hour))

```


## Graph the height of the tide by the month and the day. 

```{r}
data_1_day <- tidal_cycles<- filter(tidal_cycles, enter=="2017-05-10")


ggplot(data=data_1_day)+
  geom_line(mapping=aes(x=h,y=Height))+
  ylab("Height(m)")+
  xlab("Hour")+
  ggtitle("Change in Tidal Amplitude for May 10 2017")
```

## Rename hour to h and Date_1 to enter

```{r}
names(tidal_cycles)[names(tidal_cycles) == "Hour"] <- "h"
names(tidal_cycles)[names(tidal_cycles)=="Date_1"] <- "enter"


```

## Change enter in the tidal_cycles and aw.df to a date object. 

```{r}
library(tidyverse)
names(tidal_cycles)
sapply(tidal_cycles,class)

sapply(aw.df,class)
```

## Change enter in tidal_cycles and aw.df to a character

```{r}
aw.df$enter <- as.character(aw.df$enter)
tidal_cycles$enter <- as.character(tidal_cycles$enter)

```


## Left Join tidal_cycles by enter and h to aw.df, and aw.df.2

```{r}
tide_aw <- aw.df %>% left_join(tidal_cycles, by = "h","enter")


```


```






## Fit a poission model that has tidal height as a covariate. 

```{r}
 pg2 <-gam(n~h+ tide_aw_count$height,family=poisson,data=aw.df.2)


```

